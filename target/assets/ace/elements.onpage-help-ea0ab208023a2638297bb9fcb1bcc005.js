window.Onpage_Help=function(options){function display_help_sections(){if(active){save_sections(),body_h=document.body.scrollHeight-2,body_w=document.body.scrollWidth-2;for(var name in section_start)section_start.hasOwnProperty(name)&&save_section_offset(name);for(var name in section_start)section_start.hasOwnProperty(name)&&highlight_section(name)}}function save_sections(reset){if(reset===!0||0==section_count){reset===!0&&help_container.find(".onpage-help-section").remove(),section_start={},section_end={},section_count=0;var comments=$("*").contents().filter(function(){return 8==this.nodeType});$(comments).each(function(){var match;if(match=$.trim(this.data).match(/#section\s*:\s*([\w\d\-\.\/]+)/i)){var section_name=match[1];section_name in section_start||(section_start[section_name]=this)}if(match=$.trim(this.data).match(/\/section\s*:\s*([\w\d\-\.\/]+)/i)){var section_name=match[1];!(section_name in section_end)&&section_name in section_start&&(section_end[section_name]=this,section_count++)}})}}function save_section_offset(name){if(name in section_start&&name in section_end){for(var x1=1e6,y1=1e6,x2=-1e6,y2=-1e6,visible=!1,elements=[],start=section_start[name],end=section_end[name];start!=end&&(start=start.nextSibling,null!=start);)1==start.nodeType&&elements.push(start);var elen=elements.length;if(elen>0&&!_.settings.include_all&&(elements=1==elen?[elements[0]]:[elements[0],elements[elen-1]]),$(elements).each(function(){var $this=$(this);if(!$this.is(":hidden")){var off=$this.offset(),w=$this.outerWidth(),h=$this.outerHeight();off&&w&&h&&(visible=!0,off.left<x1&&(x1=off.left),off.left+w>x2&&(x2=off.left+w),off.top<y1&&(y1=off.top),off.top+h>y2&&(y2=off.top+h))}}),!visible)return void(section_rect[name]={is_hidden:!0});x1-=1,y1-=1,x2+=1,y2+=1;var width=x2-x1,height=y2-y1;return 2>x1+width||x1>body_w||2>y1+height||y1>body_h?void(section_rect[name]={is_hidden:!0}):void(section_rect[name]={left:parseInt(x1),top:parseInt(y1),width:parseInt(width),height:parseInt(height)})}}function highlight_section(name){if(name in section_rect&&help_container){var div=help_container.find('.onpage-help-section[data-section="'+name+'"]').eq(0);0==div.length&&(div=$('<a class="onpage-help-section" href="#" />').appendTo(help_container),ie_fix&&div.append('<span class="ie-hover-fix" />'),_.settings.icon_1&&div.append('<i class="help-icon-1 '+_.settings.icon_1+'"></i>'),_.settings.icon_2&&div.append('<i class="help-icon-2 '+_.settings.icon_2+'"></i>'),div.attr("data-section",name),div.on("click",function(e){e.preventDefault(),launch_help_modal(name)}));var rect=section_rect[name];if(rect.is_hidden===!0)return void div.addClass("hidden");div.css({left:rect.left,top:rect.top,width:rect.width,height:rect.height}),div.removeClass("hidden"),div.removeClass("help-section-small help-section-smaller"),rect.height<55||rect.width<55?div.addClass("help-section-smaller"):(rect.height<75||rect.width<75)&&div.addClass("help-section-small")}}function disableBodyScroll(){if(mbody){var body=mbody[0],disableScroll=body.scrollHeight<=body.clientHeight,mousewheel_event=$.event.special.mousewheel?"mousewheel.ace.help":"mousewheel.ace.help DOMMouseScroll.ace.help";mbody.parent().off(mousewheel_event).on(mousewheel_event,function(event){if(disableScroll)event.preventDefault();else{event.deltaY=event.deltaY||0;var delta=event.deltaY>0||event.originalEvent.detail<0||event.originalEvent.wheelDelta>0?1:-1;-1==delta&&body.scrollTop+body.clientHeight>=body.scrollHeight?event.preventDefault():1==delta&&body.scrollTop<=0&&event.preventDefault()}})}}function setBodyHeight(){if(mbody){var diff=parseInt(help_modal.find(".modal-dialog").css("margin-top"));diff=diff+110+parseInt(diff/2),maxh=parseInt($(window).innerHeight()-diff+40),mbody.css({"max-height":maxh})}}function launch_help_modal(section_name,save_to_list){null==help_modal&&(help_modal=$('<div id="onpage-help-modal" class="modal onpage-help-modal" tabindex="-1" role="dialog" aria-labelledby="HelpModalDialog" aria-hidden="true">			  <div class="modal-dialog modal-lg">				<div class="modal-content">					<div class="modal-header">					  <div class="pull-right onpage-help-modal-buttons">						<button aria-hidden="true" data-navdir="up" type="button" class="disabled btn btn-white btn-success btn-sm"><i class="ace-icon fa fa-level-up fa-flip-horizontal bigger-125 icon-only"></i></button>						&nbsp;						<button aria-hidden="true" data-navdir="back" type="button" class="disabled btn btn-white btn-info btn-sm"><i class="ace-icon fa fa-arrow-left icon-only"></i></button>						<button aria-hidden="true" data-navdir="forward" type="button" class="disabled btn btn-white btn-info  btn-sm"><i class="ace-icon fa fa-arrow-right icon-only"></i></button>						&nbsp;						<button aria-hidden="true" data-dismiss="modal" class="btn btn-white btn-danger btn-sm" type="button"><i class="ace-icon fa fa-times icon-only"></i></button>					  </div>					  <h4 class="modal-title">Help Dialog</h4>					</div>					<div class="modal-body"><div class="onpage-help-content"></div></div>				</div>			  </div>			</div>').appendTo("body"),mbody=help_modal.find(".modal-body"),mbody.css({"overflow-y":"auto","overflow-x":"hidden"}),help_modal.css({overflow:"hidden"}).on("show.bs.modal",function(){releaseFocus()}).on("hidden.bs.modal",function(){captureFocus()}),help_modal.find(".onpage-help-modal-buttons").on("click","button[data-navdir]",function(){var dir=$(this).attr("data-navdir");if("back"==dir)nav_pos>0&&(nav_pos--,launch_help_modal(nav_list[nav_pos],!1));else if("forward"==dir)nav_pos<nav_list.length-1&&(nav_pos++,launch_help_modal(nav_list[nav_pos],!1));else if("up"==dir){var url,$this=$(this);if($this.hasClass("disabled")||!(url=$this.attr("data-url")))return;launch_help_modal(url,!0)}})),help_modal.hasClass("in")||(document.body.lastChild!=help_modal[0]&&$(document.body).append(help_modal),help_modal.modal("show"),setBodyHeight()),help_modal.find(".modal-title").wrapInner("<span class='hidden' />").append('<i class="fa fa-spinner fa-spin blue bigger-125"></i>');var content=$(".onpage-help-content");content.addClass("hidden"),$(document.body).removeClass("modal-open");var parts=section_name.match(/file\:(.*?)\:(.+)/i);return parts&&3==parts.length?void display_codeview(parts[2],parts[1],!1):(section_name=section_name.replace(/^#/g,""),"function"==typeof _.settings.section_url&&(url=_.settings.section_url.call(self,section_name)),void $.ajax({url:url,dataType:"text"}).done(function(result){var title="",excerpt="";if("function"==typeof _.settings.section_title)title=_.settings.section_title.call(self,result,section_name,url);else for(var escapeSpecialChars=function(name){return name.replace(/[\-\.\(\)\=\"\'\\\/]/g,function(a){return"\\"+a})},tname=section_name;0==title.length;){var reg_str='\\<([a-z][a-z0-9]*)(?:\\s+)(?:[^\\<\\>]+?)data\\-id\\=\\"\\#'+escapeSpecialChars(tname)+'\\"(?:[^\\>]*)\\>([\\s\\S]*?)</\\1>',arr=(new RegExp(reg_str,"im"),result.match(reg_str));if(arr&&arr[2]){title=arr[2];break}var tpos;if(!((tpos=tname.lastIndexOf("."))>-1))break;tname=tname.substr(0,tpos)}if(help_modal.find(".modal-title").html($.trim(title)||"&nbsp;"),"function"==typeof _.settings.section_content)excerpt=_.settings.section_content.call(self,result,section_name,url);else{var find1="<!-- #section:"+section_name+" -->",pos1=result.indexOf(find1),pos2=result.indexOf("<!-- /section:"+section_name+" -->",pos1);if(-1==pos1||-1==pos2)return void help_modal.find(".modal-title").html("&nbsp;");excerpt=result.substring(pos1+find1.length+1,pos2)}if(excerpt="function"==typeof _.settings.code_highlight?_.settings.code_highlight.call(self,excerpt):excerpt.replace(/\<pre((?:(?:.*?)(?:data\-language=["'](?:[\w\d]+)["'])(?:.*?))|(?:(?:.*?)(?:class=["'](?:.*?)language\-(?:[\w\d]+)(?:.*?)["'])(?:.*?)))\>([\s\S]+?)\<\/pre\>/gi,function(a,b,c){return"<pre"+b+">"+c.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")+"</pre>"}),"function"==typeof _.settings.img_url&&(excerpt=excerpt.replace(/\<img(?:(?:.*?)src=["']([^"']+)["'])/gi,function(img,src){var new_src=_.settings.img_url.call(self,src);return img.replace(src,new_src)})),content.empty().append(excerpt),"function"==typeof _.settings.code_highlight)_.settings.code_highlight.call(self,content);else if("rainbow"===_.settings.code_highlight)try{Rainbow.color(content[0])}catch(e){}else if("prism"===_.settings.code_highlight)try{content.find('pre[class*="language-"],code[class*="language-"]').each(function(){Prism.highlightElement(this)})}catch(e){}if(_.settings.add_panels){content.find(_.settings.panel_content_selector).each(function(){var header=$(this).prevAll(_.settings.panel_content_title);return 0==header.length?!1:(header=header.attr("class","panel-title").wrapInner('<a class="help-panel-toggle" href="#" data-parent="#" data-toggle="collapse" />').wrap('<div class="panel-heading" />').closest(".panel-heading"),$(this).wrap('<div class="panel panel-default panel-help"><div class="panel-collapse collapse"><div class="panel-body"></div></div></div>'),void $(this).closest(".panel").prepend(header))});var group_count=$(".panel-group").length;content.find(".panel").each(function(){if(!$(this).parent().hasClass("panel-group")){var group_id="panel-group-help-"+ ++group_count,group=$('<div class="panel-group" />').insertBefore(this);group.attr("id",group_id);var panel_id=0;group.siblings(".panel").appendTo(group),group.find(".help-panel-toggle").append('<i class="pull-right ace-icon fa fa-plus" data-icon-show="ace-icon fa fa-plus" data-icon-hide="ace-icon fa fa-minus"></i>').attr("data-parent","#"+group_id).each(function(){panel_id++,$(this).attr("data-target","#"+group_id+"-"+panel_id),$(this).closest(".panel-heading").siblings(".panel-collapse").attr("id",group_id+"-"+panel_id)})}}),$(document).off("click.help-panel-toggle",".help-panel-toggle").on("click.help-panel-toggle",".help-panel-toggle",function(e){e.preventDefault()})}content.removeClass("hidden");var images=content.find("img:visible");if(images.length>0){var ev_count=0;images.off(".help_body_scroll").on("load.help_body_scroll error.help_body_scroll",function(){$(this).off(".help_body_scroll"),ev_count++,ev_count>=images.length&&disableBodyScroll()})}disableBodyScroll(),content.find(".panel > .panel-collapse").on("shown.bs.collapse hidden.bs.collapse",function(){disableBodyScroll()}),add_to_nav_list(section_name,save_to_list);var pos=-1;(pos=section_name.lastIndexOf("."))>-1?(section_name=section_name.substr(0,pos),help_modal.find("button[data-navdir=up]").removeClass("disabled").attr("data-url",section_name)):help_modal.find("button[data-navdir=up]").addClass("disabled").removeAttr("data-url").blur()}).fail(function(){help_modal.find(".modal-title").find(".fa-spin").remove().end().find(".hidden").children().unwrap()}))}function add_to_nav_list(section_name,save_to_list){save_to_list!==!1&&(nav_list.length>0&&(nav_list=nav_list.slice(0,nav_pos+1)),nav_list[nav_list.length-1]!=section_name&&(nav_list.push(section_name),nav_pos=nav_list.length-1)),0==nav_pos?help_modal.find("button[data-navdir=back]").addClass("disabled").blur():help_modal.find("button[data-navdir=back]").removeClass("disabled"),nav_pos==nav_list.length-1?help_modal.find("button[data-navdir=forward]").addClass("disabled").blur():help_modal.find("button[data-navdir=forward]").removeClass("disabled")}function display_codeview(url,language,save_to_list){var $url=url;"function"==typeof _.settings.file_url&&(url=_.settings.file_url.call(self,url,language)),$.ajax({url:url,dataType:"text"}).done(function(result){add_to_nav_list("file:"+language+":"+$url,save_to_list),help_modal.find("button[data-navdir=up]").addClass("disabled").blur(),help_modal.find(".modal-title").html($url).wrapInner("<code />"),"json"!=language?result="css"!=language?result.replace(/\n[\t]{1,}/g,function(p){return p.replace(/\t/g,"  ")}):result.replace(/\t/g,"  "):(language="javascript",result=JSON.stringify(JSON.parse(result),null,2)),result=result.replace(/\>/g,"&gt;").replace(/\</g,"&lt;");var content=$(".onpage-help-content");if(content.removeClass("hidden").empty(),"function"==typeof _.settings.code_highlight)result=_.settings.code_highlight.call(self,result,language),content.html(result);else if("rainbow"===_.settings.code_highlight)try{Rainbow.color(result,language,function(highlighted_code){content.html(highlighted_code).wrapInner('<pre data-language="'+language+'" />')})}catch(e){}else if("prism"===_.settings.code_highlight)try{result=Prism.highlight(result,Prism.languages[language],language),content.html(result).wrapInner('<pre class="language-'+language+'" />')}catch(e){}})}var $=window.jQuery||null;if(null!=$){options=options||{};var defaults={include_all:!0,icon_1:"fa fa-question",icon_2:"fa fa-lightbulb-o",base:"",code_highlight:window.Rainbow?"rainbow":window.Prism?"prism":null,add_panels:!0,panel_content_selector:".info-section",panel_content_title:".info-title"};this.settings=$.extend({},defaults,options);var body_h,body_w,ie_fix=(this.settings.base,document.all&&!window.atob),section_start={},section_end={},section_rect={},section_count=0,created=!1,active=!1,self=this,_=this,ovfx="",help_container=null,captureFocus=function(){if(help_container){var scroll=-1;$(document).off("focusin.ace.help").on("focusin.ace.help",function(e){help_container[0]==e.target||$.contains(help_container[0],e.target)||help_container.focus(),e.target==document&&scroll>-1&&($("body,html").scrollTop(scroll),scroll=-1)}),$(window).on("blur.ace.help",function(){scroll=$(window).scrollTop()})}},releaseFocus=function(){$(document).off("focusin.ace.help"),$(window).off("blur.ace.help")};this.toggle=function(){active?self.disable():self.enable()},this.enable=function(){active||("function"!=typeof _.settings.before_enable||_.settings.before_enable.call(self)!==!1)&&(active=!0,$(".onpage-help-backdrop, .onpage-help-section").removeClass("hidden"),ovfx=document.body.style.overflowX,document.body.style.overflowX="hidden",display_help_sections(),captureFocus(),"function"==typeof _.settings.after_enable&&_.settings.after_enable.call(self))},this.disable=function(){active&&("function"==typeof _.settings.before_disable&&_.settings.before_disable.call(self)||(active=!1,$(".onpage-help-backdrop, .onpage-help-section").addClass("hidden"),document.body.style.overflowX=ovfx,releaseFocus(),"function"==typeof _.settings.after_disable&&_.settings.after_disable.call(self)))},this.is_active=function(){return active},this.show_section_help=function(section){launch_help_modal(section,!0)},this.init=function(){created||(help_container=$('<div class="onpage-help-container" id="onpage-help-container" tabindex="-1" />').appendTo("body"),help_container.append('<div class="onpage-help-backdrop hidden" />'),$(window).on("resize.onpage_help",function(){active&&(display_help_sections(),null!=help_modal&&help_modal.hasClass("in")&&(setBodyHeight(),disableBodyScroll()))}),created=!0)},this.init(),this.update_sections=function(){save_sections(!0)};var nav_list=[],nav_pos=-1,mbody=null,maxh=0,help_modal=null;$(document).on("click",'.onpage-help-modal a[href^="http"]',function(){$(this).attr("target","_blank")}),$(document).on("click",".help-more",function(e){e.preventDefault();var href=$(this).attr("href");launch_help_modal(href)}),$(document).on("click",".open-file[data-open-file]",function(){help_modal.find(".modal-title").wrapInner("<span class='hidden' />").append('<i class="fa fa-spinner fa-spin blue bigger-125"></i>'),$(".onpage-help-content").addClass("hidden");var url=$(this).attr("data-path")||$(this).text(),language=$(this).attr("data-open-file");display_codeview(url,language,!0)})}};